On faisait 	stack.pop() 

au lieu de 	state=stack.pop() 